<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AÅŸk Puzzle ðŸ’–</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle, #ffb3d9, #ff4da6, #cc0066);
        font-family: 'Playfair Display', serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }

    #game {
        display: flex;
        gap: 25px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        max-width: 95%;
    }

    #pieces {
        width: 330px;
        height: 330px;
        background: rgba(255,255,255,0.9);
        border-radius: 20px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
        display: flex;
        flex-wrap: wrap;
        overflow: auto;
        justify-content: center;
    }

    .piece {
        width: 55px;
        height: 55px;
        margin: 5px;
        background-size: 330px 330px;
        border-radius: 5px;
        cursor: grab;
    }

    #board {
        width: 330px;
        height: 330px;
        background: rgba(255,245,250,0.95);
        border-radius: 20px;
        display: grid;
        grid-template-columns: repeat(6, 55px);
        grid-template-rows: repeat(6, 55px);
        gap: 5px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
    }

    .slot {
        width: 55px;
        height: 55px;
        background: #ffe0f0;
        border-radius: 5px;
    }

    #winBox {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 25px;
        border-radius: 20px;
        text-align: center;
        width: 300px;
        box-shadow: 0 0 30px rgba(0,0,0,0.5);
        color: #b30047;
        font-size: 1.2em;
        z-index: 10;
    }

    #winBox button {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        background: #ff4da6;
        color: white;
        border-radius: 10px;
        font-size: 1em;
        cursor: pointer;
    }
</style>
</head>

<body>

<div id="game">
    <div id="pieces"></div>
    <div id="board"></div>
</div>

<div id="winBox">
    ðŸ’– Tebrikler AÅŸkÄ±m! ðŸ’–  
    <br><br>
    Puzzle'Ä± baÅŸarÄ±yla tamamladÄ±n!  
    <br><br>
    <button onclick="location.href='yenibolum3.html'">â¬… Geri</button>
    <button onclick="location.href='finalson.html'">Ä°leri âžœ</button>
</div>

<script>
/* ============================
      PUZZLE AYARLARI
============================ */

const rows = 6;
const cols = 6;
const totalPieces = rows * cols;

const image = "images/Puzzle1.jpg";

const piecesContainer = document.getElementById("pieces");
const board = document.getElementById("board");

/* SlotlarÄ± oluÅŸtur */
for (let i = 0; i < totalPieces; i++) {
    const slot = document.createElement("div");
    slot.classList.add("slot");
    slot.dataset.index = i;
    slot.addEventListener("drop", dropPiece);
    slot.addEventListener("dragover", (e) => e.preventDefault());
    board.appendChild(slot);
}

/* ParÃ§alarÄ± oluÅŸtur */
let pieces = [];

for (let i = 0; i < rows; i++) {
    for (let j = 0; j < cols; j++) {

        let piece = document.createElement("div");
        piece.classList.add("piece");
        piece.draggable = true;

        let index = i * cols + j;
        piece.dataset.index = index;

        piece.style.backgroundImage = `url(${image})`;
        piece.style.backgroundPosition = `-${j * 55}px -${i * 55}px`;

        piece.addEventListener("dragstart", dragPiece);

        /* ðŸ“± Dokunmatik sÃ¼rÃ¼kleme ekledim */
        piece.addEventListener("touchstart", touchStart, { passive: false });
        piece.addEventListener("touchmove", touchMove, { passive: false });
        piece.addEventListener("touchend", touchEnd);

        pieces.push(piece);
    }
}

pieces.sort(() => Math.random() - 0.5);
pieces.forEach(p => piecesContainer.appendChild(p));

let draggedPiece = null;
let originalParent = null;
let offsetX = 0;
let offsetY = 0;

/* ============================
        MOUSE SÃœRÃœKLEME
============================ */
function dragPiece(e) {
    draggedPiece = e.target;
}

/* ============================
    DOKUNMATÄ°K SÃœRÃœKLEME
============================ */

function touchStart(e) {
    e.preventDefault();

    draggedPiece = e.target;
    originalParent = draggedPiece.parentElement;

    const rect = draggedPiece.getBoundingClientRect();
    const touch = e.touches[0];

    offsetX = touch.clientX - rect.left;
    offsetY = touch.clientY - rect.top;

    draggedPiece.style.position = "fixed";
    draggedPiece.style.zIndex = "9999";
}

function touchMove(e) {
    if (!draggedPiece) return;
    e.preventDefault();

    const touch = e.touches[0];
    draggedPiece.style.left = (touch.clientX - offsetX) + "px";
    draggedPiece.style.top = (touch.clientY - offsetY) + "px";
}

function touchEnd(e) {
    if (!draggedPiece) return;

    const touch = e.changedTouches[0];
    const element = document.elementFromPoint(touch.clientX, touch.clientY);

    if (element && element.classList.contains("slot")) {
        const targetIndex = element.dataset.index;
        const pieceIndex = draggedPiece.dataset.index;

        if (targetIndex === pieceIndex) {
            element.appendChild(draggedPiece);
            resetPiece(draggedPiece);
            draggedPiece = null;
            checkWin();
            return;
        }
    }

    originalParent.appendChild(draggedPiece);
    resetPiece(draggedPiece);
    draggedPiece = null;
}

function resetPiece(piece) {
    piece.style.position = "relative";
    piece.style.left = "0px";
    piece.style.top = "0px";
    piece.style.zIndex = "1";
}

/* ============================
        MOUSE DROP
============================ */
function dropPiece(e) {
    if (!draggedPiece) return;

    const targetIndex = e.target.dataset.index;
    const pieceIndex = draggedPiece.dataset.index;

    if (targetIndex === pieceIndex) {
        e.target.appendChild(draggedPiece);
        draggedPiece.style.cursor = "default";
        draggedPiece.draggable = false;

        checkWin();
    }
}

/* Puzzle tamamlandÄ± mÄ±? */
function checkWin() {
    const slots = document.querySelectorAll(".slot");
    let correct = 0;

    slots.forEach(slot => {
        if (slot.children.length > 0) {
            let piece = slot.children[0];
            if (piece.dataset.index === slot.dataset.index) correct++;
        }
    });

    if (correct === totalPieces) {
        document.getElementById("winBox").style.display = "block";
    }
}
</script>

</body>
</html>