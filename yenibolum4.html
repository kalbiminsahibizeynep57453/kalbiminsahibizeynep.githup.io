<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AÅŸk Puzzle ðŸ’–</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle, #ffb3d9, #ff4da6, #cc0066);
        font-family: 'Playfair Display', serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }

    #game {
        display: flex;
        gap: 25px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        max-width: 95%;
    }

    #pieces {
        width: 330px;
        height: 330px;
        background: rgba(255,255,255,0.9);
        border-radius: 20px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
        display: flex;
        flex-wrap: wrap;
        overflow: auto;
        justify-content: center;
    }

    .piece {
        width: 55px;
        height: 55px;
        margin: 5px;
        border-radius: 5px;
        cursor: grab;
        touch-action: none;
        background-repeat: no-repeat;
    }

    #board {
        width: 330px;
        height: 330px;
        background: rgba(255,245,250,0.95);
        border-radius: 20px;
        display: grid;
        grid-template-columns: repeat(6, 55px);
        grid-template-rows: repeat(6, 55px);
        gap: 5px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
    }

    .slot {
        width: 55px;
        height: 55px;
        background: #ffe0f0;
        border-radius: 5px;
    }

    #winBox {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 25px;
        border-radius: 20px;
        width: 300px;
        text-align: center;
        box-shadow: 0 0 30px rgba(0,0,0,0.5);
        color: #b30047;
        font-size: 1.2em;
        z-index: 10;
    }

    #winBox button {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        background: #ff4da6;
        color: white;
        border-radius: 10px;
        font-size: 1em;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        #pieces, #board {
            width: 280px;
            height: 280px;
        }
        .piece, .slot {
            width: 45px;
            height: 45px;
        }
        #board {
            grid-template-columns: repeat(6, 45px);
            grid-template-rows: repeat(6, 45px);
        }
    }

    @media (max-width: 500px) {
        #pieces, #board {
            width: 240px;
            height: 240px;
        }
        .piece, .slot {
            width: 38px;
            height: 38px;
        }
        #board {
            grid-template-columns: repeat(6, 38px);
            grid-template-rows: repeat(6, 38px);
        }
    }
</style>
</head>

<body>

<div id="game">
    <div id="pieces"></div>
    <div id="board"></div>
</div>

<div id="winBox">
    ðŸ’– Tebrikler AÅŸkÄ±m! ðŸ’– <br><br>
    Puzzle'Ä± baÅŸarÄ±yla tamamladÄ±n! <br><br>

    <button onclick="location.href='yenibolum3.html'">â¬… Geri</button>
    <button onclick="location.href='finalson.html'">Ä°leri âžœ</button>
</div>

<script>
const rows = 6;
const cols = 6;
const totalPieces = rows * cols;
const image = "images/Puzzle1.jpg";

const piecesContainer = document.getElementById("pieces");
const board = document.getElementById("board");

/* Slotlar */
for (let i = 0; i < totalPieces; i++) {
    const slot = document.createElement("div");
    slot.classList.add("slot");
    slot.dataset.index = i;
    slot.addEventListener("drop", dropPiece);
    slot.addEventListener("dragover", (e) => e.preventDefault());
    board.appendChild(slot);
}

/* ParÃ§alarÄ± oluÅŸtur */
let pieces = [];

for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {

        let piece = document.createElement("div");
        piece.classList.add("piece");

        piece.dataset.index = r * cols + c;

        // ðŸ”¥ DÄ°NAMÄ°K PARÃ‡A GENÄ°ÅžLÄ°ÄžÄ°
        setTimeout(() => {
            let pw = piece.offsetWidth;           // gerÃ§ek geniÅŸlik
            let bgSize = pw * cols;               // tÃ¼m resmin tam geniÅŸliÄŸi

            piece.style.backgroundImage = `url(${image})`;
            piece.style.backgroundSize = `${bgSize}px ${bgSize}px`;
            piece.style.backgroundPosition =
                `-${c * pw}px -${r * pw}px`;
        }, 10);

        piece.draggable = true;
        piece.addEventListener("dragstart", () => draggedPiece = piece);

        pieces.push(piece);
    }
}

pieces.sort(() => Math.random() - 0.5);
pieces.forEach(p => piecesContainer.appendChild(p));

let draggedPiece = null;

/* PC bÄ±rakma */
function dropPiece(e) {
    if (!draggedPiece) return;

    if (e.target.dataset.index === draggedPiece.dataset.index) {
        e.target.appendChild(draggedPiece);
        draggedPiece.draggable = false;
        checkWin();
    }
}

/* Kazanma */
function checkWin() {
    let correct = 0;

    document.querySelectorAll(".slot").forEach(slot => {
        if (slot.children.length &&
            slot.children[0].dataset.index === slot.dataset.index)
            correct++;
    });

    if (correct === totalPieces)
        document.getElementById("winBox").style.display = "block";
}

/* -------------------------------------------------
      MOBÄ°L (TOUCH DRAG) â€” BÃœYÃœMESÄ°Z, SORUNSUZ
-------------------------------------------------- */
let touchGhost = null;
let activeTouchId = null;

document.querySelectorAll(".piece").forEach(piece => {
    piece.addEventListener("touchstart", touchStart, { passive: false });
});

function touchStart(e) {
    e.preventDefault();

    draggedPiece = e.target;
    let touch = e.touches[0];
    activeTouchId = touch.identifier;

    const rect = draggedPiece.getBoundingClientRect();

    touchGhost = draggedPiece.cloneNode(true);
    touchGhost.style.position = "fixed";
    touchGhost.style.left = rect.left + "px";
    touchGhost.style.top = rect.top + "px";
    touchGhost.style.width = rect.width + "px";
    touchGhost.style.height = rect.height + "px";
    touchGhost.style.zIndex = "9999";
    touchGhost.style.opacity = "0.9";
    touchGhost.style.pointerEvents = "none";

    document.body.appendChild(touchGhost);

    document.addEventListener("touchmove", touchMove, { passive: false });
    document.addEventListener("touchend", touchEnd);
}

function touchMove(e) {
    e.preventDefault();
    if (!touchGhost) return;

    let touch = [...e.touches].find(t => t.identifier === activeTouchId);
    if (!touch) return;

    touchGhost.style.left = (touch.clientX - touchGhost.offsetWidth / 2) + "px";
    touchGhost.style.top = (touch.clientY - touchGhost.offsetHeight / 2) + "px";
}

function touchEnd(e) {
    let touch = e.changedTouches[0];
    let x = touch.clientX;
    let y = touch.clientY;

    let placed = false;

    document.querySelectorAll(".slot").forEach(slot => {
        let rect = slot.getBoundingClientRect();

        if (x > rect.left && x < rect.right &&
            y > rect.top && y < rect.bottom) {

            if (slot.dataset.index === draggedPiece.dataset.index) {
                slot.appendChild(draggedPiece);
                placed = true;
                checkWin();
            }
        }
    });

    cleanupTouch();
}

function cleanupTouch() {
    if (touchGhost) touchGhost.remove();
    touchGhost = null;
    draggedPiece = null;
    activeTouchId = null;

    document.removeEventListener("touchmove", touchMove);
}
</script>

</body>
</html>