<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AÅŸk Puzzle ðŸ’–</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: radial-gradient(circle, #ffb3d9, #ff4da6, #cc0066);
        font-family: 'Playfair Display', serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }

    #game {
        display: flex;
        gap: 25px;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        max-width: 95%;
    }

    #pieces {
        width: 330px;
        height: 330px;
        background: rgba(255,255,255,0.9);
        border-radius: 20px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
        display: flex;
        flex-wrap: wrap;
        overflow: auto;
        justify-content: center;
    }

    .piece {
        width: 55px;
        height: 55px;
        margin: 5px;
        background-size: 330px 330px !important;
        background-repeat: no-repeat;
        border-radius: 5px;
        cursor: grab;
        touch-action: none;
    }

    #board {
        width: 330px;
        height: 330px;
        background: rgba(255,245,250,0.95);
        border-radius: 20px;
        display: grid;
        grid-template-columns: repeat(6, 55px);
        grid-template-rows: repeat(6, 55px);
        gap: 5px;
        padding: 10px;
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
    }

    .slot {
        width: 55px;
        height: 55px;
        background: #ffe0f0;
        border-radius: 5px;
    }

    #winBox {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 25px;
        border-radius: 20px;
        width: 300px;
        text-align: center;
        box-shadow: 0 0 30px rgba(0,0,0,0.5);
        color: #b30047;
        font-size: 1.2em;
        z-index: 10;
    }

    #winBox button {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        background: #ff4da6;
        color: white;
        border-radius: 10px;
        font-size: 1em;
        cursor: pointer;
    }

    @media (max-width: 768px) {
        body { height: auto; padding: 20px 0; }

        #game { flex-direction: column; gap: 18px; }

        #pieces, #board {
            width: 280px;
            height: 280px;
            padding: 8px;
        }

        .piece, .slot {
            width: 45px;
            height: 45px;
        }

        #board {
            grid-template-columns: repeat(6, 45px);
            grid-template-rows: repeat(6, 45px);
            gap: 4px;
        }

        .piece { background-size: 270px 270px !important; }
    }

    @media (max-width: 500px) {
        #pieces, #board {
            width: 240px;
            height: 240px;
        }

        .piece, .slot {
            width: 38px;
            height: 38px;
        }

        #board {
            grid-template-columns: repeat(6, 38px);
            grid-template-rows: repeat(6, 38px);
            gap: 3px;
        }

        .piece { background-size: 230px 230px !important; }
    }
</style>
</head>

<body>

<div id="game">
    <div id="pieces"></div>
    <div id="board"></div>
</div>

<div id="winBox">
    ðŸ’– Tebrikler AÅŸkÄ±m! ðŸ’– <br><br>
    Puzzle'Ä± baÅŸarÄ±yla tamamladÄ±n! <br><br>

    <button onclick="location.href='yenibolum3.html'">â¬… Geri</button>
    <button onclick="location.href='finalson.html'">Ä°leri âžœ</button>
</div>

<script>
/* ============================
      PUZZLE AYARLARI
============================ */

const rows = 6;
const cols = 6;
const totalPieces = rows * cols;

const image = "images/Puzzle1.jpg";

const piecesContainer = document.getElementById("pieces");
const board = document.getElementById("board");

/* SlotlarÄ± oluÅŸtur */
for (let i = 0; i < totalPieces; i++) {
    const slot = document.createElement("div");
    slot.classList.add("slot");
    slot.dataset.index = i;
    slot.addEventListener("drop", dropPiece);
    slot.addEventListener("dragover", (e) => e.preventDefault());
    board.appendChild(slot);
}

/* ParÃ§alarÄ± oluÅŸtur */
let pieces = [];

for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {

        let piece = document.createElement("div");
        piece.classList.add("piece");
        piece.draggable = true;

        let index = r * cols + c;
        piece.dataset.index = index;

        /* ðŸ”¥ FOTOÄžRAF PARÃ‡ALAMA TAM DÃœZELTÄ°LMÄ°Åž */
        piece.style.backgroundImage = `url(${image})`;
        piece.style.backgroundPosition = `-${c * 55}px -${r * 55}px`;
        piece.style.backgroundSize = `330px 330px`;

        piece.addEventListener("dragstart", dragPiece);

        pieces.push(piece);
    }
}

pieces.sort(() => Math.random() - 0.5);
pieces.forEach(p => piecesContainer.appendChild(p));

let draggedPiece = null;

/* PC drag */
function dragPiece(e) {
    draggedPiece = e.target;
}

function dropPiece(e) {
    if (!draggedPiece) return;

    const targetIndex = e.target.dataset.index;
    const pieceIndex = draggedPiece.dataset.index;

    if (targetIndex === pieceIndex) {
        e.target.appendChild(draggedPiece);
        draggedPiece.style.cursor = "default";
        draggedPiece.draggable = false;
        checkWin();
    }
}

/* Puzzle tamamlandÄ± mÄ±? */
function checkWin() {
    const slots = document.querySelectorAll(".slot");
    let correct = 0;

    slots.forEach(slot => {
        if (slot.children.length > 0) {
            let piece = slot.children[0];
            if (piece.dataset.index === slot.dataset.index) correct++;
        }
    });

    if (correct === totalPieces) {
        document.getElementById("winBox").style.display = "block";
    }
}

/* ============================
   DOKUNMATÄ°K (MOBÄ°L)
============================ */

const isTouchDevice =
    "ontouchstart" in window ||
    navigator.maxTouchPoints > 0 ||
    navigator.msMaxTouchPoints > 0;

let touchGhost = null;
let activeTouchId = null;

if (isTouchDevice) {
    const allPieces = document.querySelectorAll(".piece");
    allPieces.forEach(piece => {
        piece.draggable = false;
        piece.addEventListener("touchstart", handleTouchStart, { passive: false });
    });
}

function handleTouchStart(e) {
    e.preventDefault();

    const touch = e.touches[0];
    draggedPiece = e.target;
    activeTouchId = touch.identifier;

    const rect = draggedPiece.getBoundingClientRect();

    touchGhost = draggedPiece.cloneNode(true);
    touchGhost.style.position = "fixed";
    touchGhost.style.left = rect.left + "px";
    touchGhost.style.top = rect.top + "px";
    touchGhost.style.width = rect.width + "px";
    touchGhost.style.height = rect.height + "px";
    touchGhost.style.margin = "0";
    touchGhost.style.zIndex = "9999";
    touchGhost.style.opacity = "0.9";
    touchGhost.style.pointerEvents = "none";

    document.body.appendChild(touchGhost);

    document.addEventListener("touchmove", handleTouchMove, { passive: false });
    document.addEventListener("touchend", handleTouchEnd);
    document.addEventListener("touchcancel", handleTouchEnd);
}

function handleTouchMove(e) {
    e.preventDefault();
    if (!touchGhost) return;

    let touch = null;
    for (let t of e.touches) {
        if (t.identifier === activeTouchId || activeTouchId === null) {
            touch = t;
            break;
        }
    }
    if (!touch) return;

    const w = touchGhost.offsetWidth;
    const h = touchGhost.offsetHeight;

    touchGhost.style.left = (touch.clientX - w / 2) + "px";
    touchGhost.style.top = (touch.clientY - h / 2) + "px";
}

function handleTouchEnd(e) {
    const touch = e.changedTouches[0];
    const x = touch.clientX;
    const y = touch.clientY;

    let placed = false;

    const slots = document.querySelectorAll(".slot");
    slots.forEach(slot => {
        const rect = slot.getBoundingClientRect();

        if (x > rect.left && x < rect.right && y > rect.top && y < rect.bottom) {
            if (slot.dataset.index === draggedPiece.dataset.index) {
                slot.appendChild(draggedPiece);
                placed = true;
                checkWin();
            }
        }
    });

    cleanupTouch();
}

function cleanupTouch() {
    if (touchGhost && touchGhost.parentNode) {
        touchGhost.parentNode.removeChild(touchGhost);
    }
    touchGhost = null;
    draggedPiece = null;
    activeTouchId = null;

    document.removeEventListener("touchmove", handleTouchMove);
    document.removeEventListener("touchend", handleTouchEnd);
    document.removeEventListener("touchcancel", handleTouchEnd);
}
</script>
</body>
</html>